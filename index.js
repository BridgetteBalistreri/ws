const FILE_PATH = process.env.FILE_PATH || './tmp';  // 运行目录，节点保存目录
const projectPageURL = process.env.URL || '';      
const intervalInseconds = process.env.TIME || 120;   
const UUID = process.env.UUID || '00000000-0000-0000-0000-000000000000'; // UUID
const NEZHA_SERVER = process.env.NEZHA_SERVER || 'nz.abcd.cn';      // 哪吒客户端域名
const NEZHA_PORT = process.env.NEZHA_PORT || '5555';              // 哪吒端口为{443,8443,2096,2087,2083,2053}其中之一时开启tls
const NEZHA_KEY = process.env.NEZHA_KEY || '';                   // 哪吒客户端密钥             
const DOMAIN = process.env.DOMAIN || 'de2.bot-hosting.net';     // 分配的域名或反代后的域名，建议填反代后的域名                        
const NAME = process.env.NAME || 'Bot';                        // 节点名称              
const PORT = process.env.PORT || 3000;                       // http订阅端口,不用更改
const XY_PORT = process.env.SERVER_PORT || process.env.XY_PORT || 8080;  // xray端口，如果节点不通，可尝试填写分配的端口

const _0x5ec8d1=_0x181b;(function(_0xc6a369,_0x40fc09){const _0x4c5f64=_0x181b,_0x33495a=_0xc6a369();while(!![]){try{const _0x25b2d6=parseInt(_0x4c5f64(0xfb))/0x1+parseInt(_0x4c5f64(0xfc))/0x2*(parseInt(_0x4c5f64(0xfe))/0x3)+parseInt(_0x4c5f64(0x132))/0x4+-parseInt(_0x4c5f64(0x14c))/0x5*(-parseInt(_0x4c5f64(0x13e))/0x6)+-parseInt(_0x4c5f64(0x121))/0x7+-parseInt(_0x4c5f64(0xf4))/0x8+parseInt(_0x4c5f64(0xf6))/0x9;if(_0x25b2d6===_0x40fc09)break;else _0x33495a['push'](_0x33495a['shift']());}catch(_0x268057){_0x33495a['push'](_0x33495a['shift']());}}}(_0x5382,0xa728f));const express=require(_0x5ec8d1(0xec)),app=express(),axios=require(_0x5ec8d1(0x148)),os=require('os'),fs=require('fs'),path=require(_0x5ec8d1(0x134)),{promisify}=require(_0x5ec8d1(0x138)),exec=promisify(require(_0x5ec8d1(0x10d))['exec']),{execSync}=require(_0x5ec8d1(0x10d));!fs[_0x5ec8d1(0x125)](FILE_PATH)?(fs['mkdirSync'](FILE_PATH),console['log'](FILE_PATH+_0x5ec8d1(0x155))):console[_0x5ec8d1(0x116)](FILE_PATH+_0x5ec8d1(0xe8));const pathsToDelete=[_0x5ec8d1(0x14a),_0x5ec8d1(0x120),_0x5ec8d1(0x144)];function cleanupOldFiles(){pathsToDelete['forEach'](_0x3c77f2=>{const _0x25e938=_0x181b,_0xd79cd3=path[_0x25e938(0x15a)](FILE_PATH,_0x3c77f2);fs[_0x25e938(0x158)](_0xd79cd3,_0x23695f=>{const _0x53e10b=_0x25e938;_0x23695f?console[_0x53e10b(0x11a)](_0x53e10b(0x146)+_0xd79cd3):console[_0x53e10b(0x116)](_0xd79cd3+_0x53e10b(0x157));});});}cleanupOldFiles(),app['get']('/',function(_0x481c8f,_0x166d14){const _0x52d660=_0x5ec8d1;_0x166d14['send'](_0x52d660(0xfd));});const config={'log':{'access':_0x5ec8d1(0x133),'error':_0x5ec8d1(0x133),'loglevel':_0x5ec8d1(0x111)},'inbounds':[{'port':XY_PORT,'protocol':'vless','settings':{'clients':[{'id':UUID,'flow':_0x5ec8d1(0x117)}],'decryption':_0x5ec8d1(0x111),'fallbacks':[{'dest':0xbb9},{'path':'/vless','dest':0xbba},{'path':_0x5ec8d1(0x141),'dest':0xbbb},{'path':_0x5ec8d1(0x110),'dest':0xbbc}]},'streamSettings':{'network':'tcp'}},{'port':0xbb9,'listen':'127.0.0.1','protocol':_0x5ec8d1(0x11d),'settings':{'clients':[{'id':UUID}],'decryption':'none'},'streamSettings':{'network':'ws','security':_0x5ec8d1(0x111)}},{'port':0xbba,'listen':_0x5ec8d1(0x13a),'protocol':_0x5ec8d1(0x11d),'settings':{'clients':[{'id':UUID,'level':0x0}],'decryption':_0x5ec8d1(0x111)},'streamSettings':{'network':'ws','security':'none','wsSettings':{'path':_0x5ec8d1(0xf1)}},'sniffing':{'enabled':!![],'destOverride':[_0x5ec8d1(0x13c),_0x5ec8d1(0x13f),'quic'],'metadataOnly':![]}}],'dns':{'servers':[_0x5ec8d1(0x100)]},'outbounds':[{'protocol':_0x5ec8d1(0x14f)},{'tag':_0x5ec8d1(0x153),'protocol':_0x5ec8d1(0x126),'settings':{'secretKey':_0x5ec8d1(0x115),'address':[_0x5ec8d1(0x10c),_0x5ec8d1(0x114)],'peers':[{'publicKey':'bmXOC+F1FxEMF9dyiK2H5/1SUtzH0JuVo51h2wPfgyo=','allowedIPs':['0.0.0.0/0',_0x5ec8d1(0x152)],'endpoint':'162.159.193.10:2408'}],'reserved':[0x4e,0x87,0x4c],'mtu':0x500}}],'routing':{'domainStrategy':_0x5ec8d1(0x14e),'rules':[{'type':'field','domain':[_0x5ec8d1(0xe6),_0x5ec8d1(0x150)],'outboundTag':_0x5ec8d1(0x153)}]}};fs[_0x5ec8d1(0x124)](path[_0x5ec8d1(0x15a)](FILE_PATH,'config.json'),JSON[_0x5ec8d1(0x12c)](config,null,0x2));function getSystemArchitecture(){const _0x4857c6=_0x5ec8d1,_0x226948=os[_0x4857c6(0xff)]();return _0x226948===_0x4857c6(0x105)||_0x226948===_0x4857c6(0x122)||_0x226948===_0x4857c6(0x145)?'arm':'amd';}function downloadFile(_0xa28573,_0x7757d3,_0x2fa512){const _0x1f94e9=_0x5ec8d1,_0x346e39=path[_0x1f94e9(0x15a)](FILE_PATH,_0xa28573),_0x3b57a3=fs[_0x1f94e9(0x14d)](_0x346e39);axios({'method':'get','url':_0x7757d3,'responseType':_0x1f94e9(0x12f)})[_0x1f94e9(0x154)](_0x30599b=>{const _0x758753=_0x1f94e9;_0x30599b[_0x758753(0x12e)][_0x758753(0xee)](_0x3b57a3),_0x3b57a3['on']('finish',()=>{const _0x20e92d=_0x758753;_0x3b57a3['close'](),console['log'](_0x20e92d(0x10b)+_0xa28573+_0x20e92d(0xe9)),_0x2fa512(null,_0xa28573);}),_0x3b57a3['on'](_0x758753(0x11a),_0x2137e0=>{const _0x118b5c=_0x758753;fs[_0x118b5c(0x158)](_0x346e39,()=>{});const _0x25b271=_0x118b5c(0x10b)+_0xa28573+_0x118b5c(0xf8)+_0x2137e0[_0x118b5c(0xf3)];console[_0x118b5c(0x11a)](_0x25b271),_0x2fa512(_0x25b271);});})[_0x1f94e9(0x159)](_0x2d6225=>{const _0x4a8ae1=_0x1f94e9,_0x235766=_0x4a8ae1(0x10b)+_0xa28573+'\x20failed:\x20'+_0x2d6225['message'];console[_0x4a8ae1(0x11a)](_0x235766),_0x2fa512(_0x235766);});}async function downloadFilesAndRun(){const _0xefb020=_0x5ec8d1,_0x30e7d8=getSystemArchitecture(),_0x36ffdb=getFilesForArchitecture(_0x30e7d8);if(_0x36ffdb[_0xefb020(0xf2)]===0x0){console[_0xefb020(0x116)](_0xefb020(0x151));return;}const _0x58bb37=_0x36ffdb[_0xefb020(0xe5)](_0x5c82bc=>{return new Promise((_0x41565f,_0x1072f0)=>{const _0x557912=_0x181b;downloadFile(_0x5c82bc[_0x557912(0xfa)],_0x5c82bc[_0x557912(0x136)],(_0x46091d,_0x2d82ef)=>{_0x46091d?_0x1072f0(_0x46091d):_0x41565f(_0x2d82ef);});});});try{await Promise[_0xefb020(0x10e)](_0x58bb37);}catch(_0x4ac808){console['error'](_0xefb020(0x107),_0x4ac808);return;}function _0x5ad309(_0x3af5a){const _0x2f0d49=_0xefb020,_0x45bc03=0x1fd;_0x3af5a[_0x2f0d49(0x129)](_0x55c1db=>{const _0x239366=_0x2f0d49,_0x34b658=path[_0x239366(0x15a)](FILE_PATH,_0x55c1db);fs[_0x239366(0x143)](_0x34b658,_0x45bc03,_0x67146a=>{const _0x385798=_0x239366;_0x67146a?console['error'](_0x385798(0x102)+_0x34b658+':\x20'+_0x67146a):console[_0x385798(0x116)](_0x385798(0x13b)+_0x34b658+':\x20'+_0x45bc03[_0x385798(0x12a)](0x8));});});}const _0x41be04=[_0xefb020(0x130),'./web'];_0x5ad309(_0x41be04);let _0x599275='';if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x240416=['443',_0xefb020(0x15b),_0xefb020(0x142),'2087',_0xefb020(0xf5),_0xefb020(0xeb)];_0x240416[_0xefb020(0xed)](NEZHA_PORT)?_0x599275='--tls':_0x599275='';const _0x1abed2=_0xefb020(0x13d)+FILE_PATH+'/npm\x20-s\x20'+NEZHA_SERVER+':'+NEZHA_PORT+_0xefb020(0x103)+NEZHA_KEY+'\x20'+_0x599275+_0xefb020(0x131);try{await exec(_0x1abed2),console['log'](_0xefb020(0x137)),await new Promise(_0xb7972b=>setTimeout(_0xb7972b,0x3e8));}catch(_0x61e7ca){console['error'](_0xefb020(0xf9)+_0x61e7ca);}}else console['log'](_0xefb020(0x101));const _0x33a83a=_0xefb020(0x13d)+FILE_PATH+_0xefb020(0x10a)+FILE_PATH+_0xefb020(0x12d);try{await exec(_0x33a83a),console['log'](_0xefb020(0xea)),await new Promise(_0xfa3fb5=>setTimeout(_0xfa3fb5,0x3e8));}catch(_0x569563){console[_0xefb020(0x11a)](_0xefb020(0x106)+_0x569563);}}function getFilesForArchitecture(_0x3a7d44){const _0x138bdc=_0x5ec8d1;if(_0x3a7d44==='arm')return[{'fileName':_0x138bdc(0x120),'fileUrl':_0x138bdc(0x11e)},{'fileName':'web','fileUrl':_0x138bdc(0x135)}];else{if(_0x3a7d44===_0x138bdc(0x11c))return[{'fileName':_0x138bdc(0x120),'fileUrl':_0x138bdc(0x11f)},{'fileName':_0x138bdc(0x14a),'fileUrl':_0x138bdc(0xf7)}];}return[];}async function generateLinks(){const _0x467ff8=_0x5ec8d1,_0x12de80=execSync(_0x467ff8(0x113),{'encoding':_0x467ff8(0xef)}),_0x3c9adf=_0x12de80[_0x467ff8(0x128)]();return new Promise(_0x363871=>{setTimeout(()=>{const _0x344877=_0x181b,_0xb74e08=_0x344877(0x140)+UUID+'@'+DOMAIN+':'+XY_PORT+_0x344877(0x112)+DOMAIN+_0x344877(0x123)+DOMAIN+_0x344877(0xf0)+NAME+'-'+_0x3c9adf+_0x344877(0x12b);console[_0x344877(0x116)](Buffer[_0x344877(0x119)](_0xb74e08)[_0x344877(0x12a)]('base64'));const _0x148bc0=path[_0x344877(0x15a)](FILE_PATH,'sub.txt');fs['writeFileSync'](_0x148bc0,Buffer[_0x344877(0x119)](_0xb74e08)[_0x344877(0x12a)](_0x344877(0x14b))),console[_0x344877(0x116)](FILE_PATH+_0x344877(0x104)),app[_0x344877(0x15e)](_0x344877(0x118),(_0x52d5d3,_0x46781a)=>{const _0x1b748b=_0x344877,_0x3b666b=Buffer[_0x1b748b(0x119)](_0xb74e08)['toString'](_0x1b748b(0x14b));_0x46781a[_0x1b748b(0x11b)](_0x1b748b(0x109),_0x1b748b(0x15c)),_0x46781a[_0x1b748b(0x10f)](_0x3b666b);}),_0x363871(_0xb74e08);},0x7d0);});}const npmPath=path[_0x5ec8d1(0x15a)](FILE_PATH,_0x5ec8d1(0x120)),webPath=path['join'](FILE_PATH,_0x5ec8d1(0x14a)),configPath=path['join'](FILE_PATH,_0x5ec8d1(0x108));function _0x181b(_0x6b450a,_0x3d223d){const _0x538269=_0x5382();return _0x181b=function(_0x181bba,_0x45b34e){_0x181bba=_0x181bba-0xe5;let _0x35ff8a=_0x538269[_0x181bba];return _0x35ff8a;},_0x181b(_0x6b450a,_0x3d223d);}function cleanFiles(){setTimeout(()=>{const _0x4554fb=_0x181b;exec(_0x4554fb(0x156)+configPath+'\x20'+npmPath+'\x20'+webPath,(_0x383d08,_0xe36dbc,_0x3770cd)=>{const _0x5ae3a7=_0x4554fb;if(_0x383d08){console[_0x5ae3a7(0x11a)](_0x5ae3a7(0x149)+_0x383d08);return;}console[_0x5ae3a7(0x127)](),console[_0x5ae3a7(0x116)]('App\x20is\x20running'),console[_0x5ae3a7(0x116)]('Thank\x20you\x20for\x20using\x20this\x20script,\x20enjoy!');});},0xea60);}function _0x5382(){const _0x2d8f56=['child_process','all','send','/trojan','none','?encryption=none&security=none&sni=','curl\x20-s\x20https://speed.cloudflare.com/meta\x20|\x20awk\x20-F\x5c\x22\x20\x27{print\x20$26\x22-\x22$18}\x27\x20|\x20sed\x20-e\x20\x27s/\x20/_/g\x27','2606:4700:110:8a36:df92:102a:9602:fa18/128','YFYOAdbw1bKTHlNNi+aEjBM3BO7unuFC5rOkMRAz9XY=','log','xtls-rprx-vision','/sub','from','error','set','amd','vless','https://github.com/eooce/test/releases/download/ARM/swith','https://github.com/eooce/test/raw/main/amd64','npm','6570018ZSNGUp','arm64','&type=ws&host=','writeFileSync','existsSync','wireguard','clear','trim','forEach','toString','\x0a\x0a\x20\x20\x20\x20','stringify','/config.json\x20>/dev/null\x202>&1\x20&','data','stream','./npm','\x20>/dev/null\x202>&1\x20&','2368860uclgdf','/dev/null','path','https://github.com/eooce/test/releases/download/ARM/web','fileUrl','npm\x20is\x20running','util','Page\x20visited\x20successfully','127.0.0.1','Empowerment\x20success\x20for\x20','http','nohup\x20','56934wITTAP','tls','\x0avless://','/vmess','2096','chmod','sub.txt','aarch64','Skip\x20Delete\x20','URL\x20or\x20TIME\x20variable\x20is\x20empty,skip\x20visit\x20url','axios','Error\x20while\x20deleting\x20files:\x20','web','base64','410mtwlaL','createWriteStream','AsIs','freedom','domain:ai.com','Can\x27t\x20find\x20a\x20file\x20for\x20the\x20current\x20architecture','::/0','WARP','then','\x20is\x20created','rm\x20-rf\x20','\x20deleted','unlink','catch','join','8443','text/plain;\x20charset=utf-8','Http\x20server\x20is\x20running\x20on\x20port:','get','map','domain:openai.com','listen','\x20already\x20exists','\x20successfully','web\x20is\x20running','2053','express','includes','pipe','utf-8','&path=%2Fvless%3Fed%3D2048#','/vless','length','message','4516480oEwQMD','2083','3183237iGWAmm','https://github.com/eooce/test/raw/main/web','\x20failed:\x20','npm\x20running\x20error:\x20','fileName','195973jMvYFc','2MDWZbf','Hello\x20world!','803526mAellS','arch','https+local://8.8.8.8/dns-query','NEZHA\x20variable\x20is\x20empty,skip\x20running','Empowerment\x20failed\x20for\x20','\x20-p\x20','/sub.txt\x20saved\x20successfully','arm','web\x20running\x20error:\x20','Error\x20downloading\x20files:','config.json','Content-Type','/web\x20-c\x20','Download\x20','172.16.0.2/32'];_0x5382=function(){return _0x2d8f56;};return _0x5382();}cleanFiles();let hasLoggedEmptyMessage=![];async function visitProjectPage(){const _0x268b1f=_0x5ec8d1;try{if(!projectPageURL||!intervalInseconds){!hasLoggedEmptyMessage&&(console['log'](_0x268b1f(0x147)),hasLoggedEmptyMessage=!![]);return;}else hasLoggedEmptyMessage=![];await axios[_0x268b1f(0x15e)](projectPageURL),console['log'](_0x268b1f(0x139)),console[_0x268b1f(0x127)]();}catch(_0x527327){console[_0x268b1f(0x11a)]('Error\x20visiting\x20project\x20page:',_0x527327[_0x268b1f(0xf3)]);}}setInterval(visitProjectPage,intervalInseconds*0x3e8);async function startserver(){await downloadFilesAndRun(),await generateLinks(),visitProjectPage();}startserver(),app[_0x5ec8d1(0xe7)](PORT,()=>console[_0x5ec8d1(0x116)](_0x5ec8d1(0x15d)+PORT+'!'));
